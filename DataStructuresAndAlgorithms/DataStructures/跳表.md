## 跳表 Skip List

### 跳表数据结构

跳表是一种各方面性能都比较优秀的**动态数据结构**，可以支持快速的插入、删除、查找操作，甚至可以代替红黑树（Red-black tree）

Redis 中的有序集合就是用跳表实现。对于一个单链表即使链表中存储的数据是有序的，如果要想在其中查找某个数据，只能从头到尾遍历链表，时间复杂度是 O(n)。对链表建立一级索引，如果要查找某个结点，可以先在索引层遍历，然后通过索引层的 down 指针，下降到原始链表这一层，继续遍历。**链表加多级索引的结构，就是跳表**。**第 K 级索引的节点个数是第 k - 1 级索引的节点个数的 1/2，那第 k 级索引节点的个数就是 `n/(2^k)`**

####时间复杂度

假设索引有 h 级，最高级的索引有 2 个节点。`n/(2^h)=2` ，`h = log2n-1`，如果包含原始链表这一层，整个跳表的高度就是 `log2n`。在跳表中查询某个数据的时候，如果每一层都要遍历 m 个节点，那在跳表中查询一个数据的时间复杂度就是 `O(m*logn)`

#### 空间复杂度

比起单纯的单链表，跳表需要存储多级索引，会消耗更多的存储空间。跳表的空间复杂度是 `O(n)`。如果将包含 n 个节点的单链表构成跳表，需要额外再用 n 个节点的存储空间。

#### 跳表索引动态更新

当不停往跳表中插入数据时，如果不更新索引，就可能出现某 2 个索引节点之间数据非常多的情况，极端情况下，跳表还会退化成单链表。作为一种动态数据结构，需要某种手段来维护索引与原始链表大小之间的平衡，即如果链表中节点多了，索引节点就响应的增加，避免复杂度退化，即查找、插入、删除操作性能下降。跳表通过随机函数来维护平衡，当往跳表中插入数据的时候，可以选择同时将这个数据插入到部分索引层中。通过一个随机函数，来决定将这个节点插入到哪几级索引中，如随机函数生成了值 K，那么就将这个节点添加到第一级到第 K 级这 K 级索引中

*跳表插入平衡性*

![](../Images/DataStructures/跳表插入平衡性.jpg)

