### 正则表达式

#### 语法

##### 特殊字符

###### 基本元字符

|  元字符  |                说明                |
| :------: | :--------------------------------: |
|    .     | 匹配任意单个字符（不包括行结束符） |
|    \|    |            逻辑或操作符            |
| (?:_re_) |             不获取括号             |
|    []    |      匹配字符集合中的一个字符      |
|   [^]    |           对字符集合求非           |
|    -     |         定义一个区间 `A-Z`         |
|    \     |          对下一个字符转义          |

###### 数量元字符 

| 元字符  |                        说明                        |
| :-----: | :------------------------------------------------: |
|    *    |     匹配前一个字符（子表达式）的零次或多次重复     |
|   *?    |                    * 的惰性版本                    |
|    +    |     匹配前一个字符（子表达式）的一次或多次重复     |
|   +?    |                    + 的惰性版本                    |
|    ?    |    匹\配前一个字符（子表达式）的零次或一次重复     |
|   {n}   |       匹配前一个字符（子表达式）的 n 次重复        |
| {m, n}  | 匹配前一个字符（子表达式）至少 m 次且至多 n 次重复 |
| {m, n}+ |   独占匹配至少 m 个但不多于 n 个匹配（非常贪婪）   |
| {m, }+  |        独占匹配，m个及以上匹配（非常贪婪）         |
| {, n}+  |              独占匹配：0 到 n 个匹配               |
|  {n, }  |     匹配前一个字符（子表达式）n 次或更多次重复     |
| {n, }?  |                  {n, } 的惰性版本                  |
|  {, n}  |                   最多 n 个匹配                    |
| {, n}?  |                   0 到 n 个惰性                    |

*，+ 都是贪婪型元字符，它们在进行匹配时的行为模式是多多益善，他们会尽可能地从一段文本的开头一直匹配到这段文笔的末尾，而不是从这段文本的开头匹配到碰到的第一个匹配时为止

懒惰型匹配是在贪婪元字符后面加 ? 后缀

###### 位置元字符

| 元字符 |                             说明                             |
| :----: | :----------------------------------------------------------: |
|   ^    |                       行或字符串的起始                       |
|   \A   |                       整个字符串的开始                       |
|   $    |                       行或字符串的结束                       |
|   \z   |                       整个字符串的结束                       |
|   \Z   |               匹配字符串的结束（除了行结束符）               |
|  \\<   |                        匹配单词的开头                        |
|  \\>   |                        匹配单词的结束                        |
|   \b   | 匹配单词边界（\bcat 以 cat 开头的任何单词 cat\b 以 cat 结尾的任何单词，\bcat\b 匹配 cat ） |
|   \B   |                   \b 的反义（非单词边界）                    |
|   \G   |                        前一匹配的结束                        |
|   \n   |                    向后引用获取子表达式n                     |
| （?m） | 分行匹配模式，使正则表达式引擎把行分隔符作为一个字符串分隔符来对待。 |

在分行匹配模式下，^ 不仅匹配正常的字符串开头，还将匹配行分割符（换行符）后面开始位置（这个位置不可见）；$ 不仅匹配正常的字符串结尾，还将匹配行分割符（换行符）后面的位置结束，在使用时 (?m) 必须出现在整个模式的最前面

```regex
// 匹配 // 单行注释
(?m)^\s*//.\*$
```

###### 特殊字符元字符

| 元字符 |               说明               |     等价于      |
| :----: | :------------------------------: | :-------------: |
|  [\b]  |             退格字符             |                 |
|   \c   |         匹配一个控制字符         |                 |
|   \d   |         匹配任意数字字符         |      [0-9]      |
|   \D   |            \d 的反义             |     [^0-9]      |
|   \f   |              换页符              |                 |
|   \n   |              换行符              |                 |
|   \r   |              回车符              |                 |
|   \s   |         匹配一个空白字符         |  [\f\n\r\t\v]   |
|   \S   |            \s 的反义             | `[^\f\n\r\t\v]` |
|   \t   |        制表符（tab字符）         |                 |
|   \v   |            垂直制表符            |                 |
|   \w   | 匹配任意字母数字字符或下划线字符 |  [a-zA-Z0-9_]   |
|   \W   |            \w 的反义             |  [^a-zA-Z0-9_]  |
|   \x   |       匹配一个十六进制数字       |                 |
|   \0   |        匹配一个八进制数字        |                 |

###### 回朔引用和前后查找

| 元字符  |                        说明                         |
| :-----: | :-------------------------------------------------: |
|   ()    |                  定义一个子表达式                   |
|   \1    | 匹配第一个子表达式；\2 代表第二个子表达式，依次类推 |
|   ?=    |                      向前查找                       |
|   ?<=   |                      向后查找                       |
|   ?!    |                     负向前查找                      |
|   ?<!   |                     负向后查找                      |
|   ?()   |                   条件（if then）                   |
|  ?()\|  |                条件（if then elase）                |
| （?=）  |                     正向前查找                      |
|  (?!)   |                     负向前查找                      |
|  (?<=)  |                     正向后查找                      |
| （?<!） |                     负向后查找                      |

###### 大小写转换

| 元字符 |                   说明                   |
| :----: | :--------------------------------------: |
|   \E   |            结束 \L 或 \U 转换            |
|   \l   |          把下一个字符转换为小写          |
|   \L   | 把后面的字符转换为小写，直到遇到 \E 为止 |
|   \u   |          把下一个字符转换为大写          |
|   \U   | 把后面的字符转换为大写，直到遇到 \E 为止 |

###### POSIX 字符集

|   字符类   |                         说明                         |     等价于     |
| :--------: | :--------------------------------------------------: | :------------: |
| [:alnum:]  |                  任何一个字母或数字                  |  [a-zA-Z0-9]   |
| [:alpha:]  |                     任何一个字母                     |    [a-zA-Z]    |
| [:blank:]  |                     空格或制表符                     |     [\t ]      |
| [:cntrl:]  |   ASCII 控制字符（ASCII 0-31 与  ASCII 127 之后）    |                |
| [:digit:]  |                     任何一个数字                     |     [0-9]      |
| [:graph:]  |           和 [:print:] 一样，但不包括空格            |                |
| [:lower:]  |                   任何一个小写字母                   |     [a-z]      |
| [:print:]  |                  任何一个可打印字符                  |                |
| [:punct:]  | 即不属于 [:alnum:] 也不属于 [:cntrl:] 的任何一个字符 |                |
| [:space:]  |              任何一个空白字符，包括空格              | [^\f\n\r\t\v ] |
| [:upper:]  |                   任何一个大写字母                   |     [A-z]      |
| [:xdigit:] |                 任何一个十六进制数字                 |                |

##### 匹配操作

###### 匹配模式

*   贪婪模式

    传统的 UNIX 正则表达式唯一类型，会匹配尽可能多的次数而不影响其后的任意子表达式

*   独占模式

    会匹配尽可能多的次数而不顾及其后的子表达式

*   限定匹配

    匹配尽可能少的字符以得到一个匹配结果

###### 匹配单个字符

* g

    匹配多个结果

* i

    不区分大小写的字母匹配

###### 引用与查找

* 回朔引用

    只能用来引用模式里的子表达式，回朔引用匹配通常从 1 开始计数（\1，\2）等。在许多实现里，第0 个匹配（\0） 可以用来代表整个正则表达式

* 向前查找

    指定一个必须匹配但不在结果中返回的模式

    实际就是一个子表达式，而且从格式上也是（一个以 ?= 开头的子表达式，需要匹配的文本跟在 = 的后面，查找出现在被匹配文本之后的字符，但不消费那个字符）

* 向后查找

    查找出现在被匹配文本之前的字符（但不消费它）

* 正前后查找

    向前查找后和向后查找通常用来匹配文本，其目的是为了确定将被返回为匹配结果的文本的位置（通过指定匹配结果的前后必须是那些文本）。

*   负前后查找

    负向前查找：将向前查找不与给定模式相匹配的文本，负向后查找：将向后查找不与给定模式相匹配的文本

###### 嵌入条件

在表达式内部嵌入条件处理功能，正则表达式里的条件用 ? 来定义。

嵌入条件分为：根据一个回朔引用来进行条件处理，根据一个前后查找来进行条件处理

* ?

    匹配前一个字符或表达式，如果它存在

* ?= 和 ?<=

    匹配前面或后面的文本，如果它存在的话

    回朔引用条件只在一个前面的子表达式搜索成功的情况下才允许使用一个表达式。

    ```
    (\()?\d{3}(?(1)\)|-)\d{3}-\d{3}-\d{4}
    ```

* 前后查找条件

    只在一个向前查找或向后查找操作取得成功的情况下才允许一个表达式被使用。定义一个前后查找条件的语法与定义一个回朔引用条件的语法类似，只需把回朔引用（括号里的回朔引用编号）替换为一个完整的前后查找表达式

#### 常用支持

##### 编程语言

###### Java

* 不支持嵌入条件
* 不支持使用 \E，\l，\L，\u，\U 进行字母大小写转换
* 不支持使用 \b 匹配退格符
* 不支持 \z

java语言中的正则表达式匹配功能主要是通过 java.util.regex.matcher 类和以下方法实现的

* find()

    在一个字符串里寻找一个给定模式的匹配

* lookingAt()

    用一个给定的模式去尝试匹配一个字符串的开头

* matches()

    用一个给定模式去尝试匹配一个完整的字符串

* replaceAll()

    进行替换操作，对所有的匹配都进行替换

* replaceFirst()

    进行替换操作，只对第一个匹配进行替换

java.util.regex.pattern 类也提供了几个简单易用的包装器方法

* compile()

    把一个正则表达式编译成一个模式

* flags()

    返回某给定模式的匹配标志

* matches()

    用一个给定模式去尝试匹配一个完整的字符串

* pattern()

    把一个模式还原为一个正则表达式

* split()

    把一个字符串拆分为子字符串

###### PHP

在默认情况下，匹配操作不区分字母的大小写。如果不想区分字母的大小写，必须使用  i 限定符，默认情况下，匹配操作仅限于单行字符串。如果需要匹配多行字符串，必须使用 m 限定符，不支持 \l，\u，\L，\U，\Q，\v。有以下内置函数

* preg_grep()

    进行一个搜索，匹配结果作为数组返回

* preg_match()

    进行一次正则表达式搜索，返回第一个匹配

* preg_mathc_all()

    进行一次正则表达式搜索，返回所有的匹配

* preg_quote()

    这个函数的输入参数是一个模式，返回值是该模式的转义版本

* preg_replace()

    进行一次搜索并替换操作

* preg_replace_callback()

    进行一次搜索并替换的操作，但使用一个回调函数来完成实际替换动作

* preg_split()

    把一个字符串拆分为子字符串

preg_replace()、preg_replace_callback()、preg_split() 函数都支持一个可选的参数，该参数用来给出一个上限值（对字符串进行替换或拆分的最大次数）

##### 中间件

###### MySQL

* mysql 对正则表达式的支持体现在允许 where 子句里使用 REGEXP "expression"` `SELECT  * from table where regexp "pattern"
* 只提供了搜索支持，不支持替换操作
* 默认情况下，正则表达式搜索不区分字母的大小写。如果需要区分字母的大小写，必须再增加一个 BINARY 关键字（放在 REGEXP 和模式之间）
* 用 [[:<:]] 来匹配一个单词的开头，用 [[:>:]] 来匹配一个单词的结束
* 不支持向前预测
* 不支持嵌入条件
* 不支持八进制字符搜索
* 不支持 \a， \b， \e，\f ，\v
* 不支持回溯引用