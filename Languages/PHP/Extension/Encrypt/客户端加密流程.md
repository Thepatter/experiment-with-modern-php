### 加解密流程及示例

#### 约定

* 原始数据采用 AES 对称加密

* AES 密钥采用 RSA 公钥加密

* sha1 校验结果为小写字符串，长度为 40

* AES 加密算法为： `AES-128-CBC`； `key` 为随机 16 位小写字符串； `iv` 为 '0000000000000000'

* AES 加密 padding 为： `PKCS7Padding`

* RSA 加密 padding 为：`OPENSSL_PKCS1_PADDING`

#### 客户端原始数据加密流程

```flow
st=>start: 获取服务端 RSA 公钥（预先存储在客户端）
e=>end: 发送数据
io1=>inputoutput: 获取原始数据
op1=>operation: 将原始数据转成 json 字符串，并进行 base64 编码，得到待进行 AES 加密数据
op2=>operation: 将待 AES 加密数据进行 sha1 校验，得到待 AES 加密数据的签名
op3=>operation: 生成 AES key（16 位小写字符串）
op4=>operation: AES 加密，生成加密后的数据，并进行 base64 编码，得到 data
op5=>operation: RSA 公钥加密 AES KEY，并进行 base64 编码后拼接签名得到 secret
op6=>operation: 最终传输数据为：键 data 值为：data； 键 secret 值为：secret
st->io1->op1->op2->op3->op4->op5->op6->e
```

#### 客户端解密流程

```flow
st=>start: 接收服务端响应数据
e=>end: 对原始数据进行 base64 解码后解析 json 字符串
io1=>inputoutput: 校验是否包含键： secret 和 data 且不为空
op1=>operation: 分割 secret，取后 40 位为签名，余下为待 RSA 公钥解密的数据
op2=>operation: 将待 RSA 解密的数据进行 base64 解码后进行 RSA 公钥解密，得到 AES KEY
op3=>operation: 使用 AES KEY 解密 base64 解码后的 data 数据，得到解密后的数据
op4=>operation: 对解密后的数据进行 sha1 散列与签名对比
st->io1->op1->op2->op3->op4->e
```

#### 示例

##### 获取公钥接口

* URI
  
    `http://{{host}}/api/key`

* METHOD

    GET

* RESPONSE

    该响应是一个下载文件响应

##### 明文转密文

* URI

    `http://{{host}}/api/encrypt`

* METHOD

    POST

* PARAMETER

    `name`  ：   `张三`

    `age`   ：  `30`

    值为字符串

* RESPONSE

    ```json
    {
        "data": "naKo7RDDDCz8dFGXLaK9QBk5Hsr5QP8kImFcwvkNsVqV7h5RvyU12bKwv3R0DQnyvr17zovGi5fTWjqlWLNV5g==",
        "secret": "Zf+H/jOpdclT9jfThuRmYyiymxy0wfDb75E+ZPZV8W8EjEgf+XBSPLjuO7qDzwFt3xJVqepOA7F2yFxrWsBG4A==86a95447e7ffb3f4f892a7c481549bbf04422e2f"
    }
    ```

##### 密文转明文

* URI

  `http://{{host}}/api/decrypt`

* METHOD

  POST

* PARAMETER

  `data` ：`ANj+vQUZIs7ABgnpGc+b9MYp1bumvbNFbGCLHyzqR7XP0195yZ36UMRffbJVPn7cL40ZE6BakMKSs2XoDEXGpw==`

  `secret` ：`Fqm02t8k1zM511O4b3MXzQjt3vOA3QhvCfGj+/+BXbRyFXUqme5boVk/sFit9I9rHQTFLb3vhawiRxqh/n58Tg==86a95447e7ffb3f4f892a7c481549bbf04422e2f`

  该次 `aesKey` 为字符串： `1111111111111111`

* RESPONSE

  ```json
  {
      "name": "张三",
      "age": "30"
  }
  ```

  

