### shell base

#### 系统变量

shell 会在当前用户 `PATH` 下寻找对应命令，可以将编译后的二进制文件链接到 `PATH` 路径下来使用该文件

* 查看当前环境变量

  `echo $PATH`

* 添加 PATH，使用 `:` 分隔目录

  ```shell
export PATH=$PATH:<PATH1>:<PATH2>
  ```
  
  ```shell
  vim .bash_profile 
  export PATH=$PATH:/usr/bin:/usr/sbin
  source .bash_profile
  ```

#### 作业控制

* `jobs`

  列出当前 shell 中运行的作业，左侧的整数是作业编号，带加号的作业被当做默认作业。在使用 `fg` 和 `bg` 命令时，如果未在命令行指定任何作业编号的话，带加号的作业被当成作业控制命令的操作对象

* `&`

  放在命令行末尾的时候，让该命令作为后台作业运行

* `^Z`

  挂起当前（前台）作业。可以输入 `bg` 将命令放入后台运行或者输入 `fg` 使其在前台运行

* `suspend`

  `suspend` 将挂起当前的 shell

* `bg [%jobnumber]`

  让挂起的作业在后台运行。当不使用参数的时候，操作对象为最近挂起的作业。

* `fg [%jobnumber]`

  让挂起的作业或后台作业到前台运行。

#### 模拟多shell

* `screen`

  `^A?` 		显示所有组合键命令

  `^A^C`		创建一个窗口

  `^A0, ^A1...^A9`			分别切换到窗口 0-9

  `^A'`			提示窗口号（0-9），然后切换到该窗口

  `^A^N`			以数字方式切换到下一个创建

  `^A^P`			以数字方式切换到上一个窗口

  `^A^A`			切换到最近使用的其他窗口

  `^A^W`			列出所有的窗口

  `^AN`			显示当前窗口号

  `^D`				终止当前 shell

  `^A \`

#### 常用内置命令

##### 查看文件

```shell
# 查看完整文件
cat files
# 逐页查看文件
less files
# 利用行编号查看文本文件
nl files
# 查看文件前部分
head
# 查看文件后面部分
tail
# 显示二进制文件的文本
strings
# 以8进制显示
od
```

##### 文件属性

* 显示文件和目录的属性

  ```shell
  # -t 简洁模式，单行输出; -L 跟踪符号链接，并报告指向文件；-f 现在文件所在文件系统信息而不是文件本身信息
  stat [options] files
  ```

* 统计字节数、字数、行数

  ```shell
  # -l 仅输出行数;-w 仅输出字数;-c 仅输出字节数;-L 找出每个文件中最长的行，并以字节为单位输出该行的长度
  wc [options] [files]
  ```

* 显示文件和目录的磁盘使用情况

  ```shell
  # -b 以字节为单位, -k 以千字节为单位, -m 以兆字节为单位，-L 跟踪符号链接, s 仅输出总大小
  du [options] [files | directories]
  ```

* 识别文件类型

  ```shell
  # -b 忽略左边部分的文件名 -i 文件的 MIME 类型 -f file 从给定 file 文件中读取文件名，每行一个文件名，并报告其类型 -L 跟踪符号链接
  file [options] files
  ```

* 创建文件、更该文件和目录的时间戳

  -a 访问时间，-m 修改时间, -c 不存在不创建，-d timestamp 设置文件的时间戳 -t 20030812150047
  
  ```shell
    touch [options] files
  ```
* 设置限制新建文件权限掩码

  ```shell
  # -P 输出的权限掩码之间作为指令来指向（8进制，默认 0022） -S 以字符方式输出权限掩码
  umask [options] [mask]
  # 设置新创建文件权限掩码
  umask u=x, g=w, o=r
  # 检查默认权限掩码
  umask -S
  ```

* 改变文件属性

  `chattr` 命令用来改变文件属性。可改变存放在 `ext2` 文件系统上的文件或目录属性，这些属性共有：

  `a`：只能进行追加：只能向文件中添加数据，而不能编辑数据，只有 root 才能设定这个属性

  `A`：不访问时间戳：对这个文件进行访问不会更新其访问时间戳（atime）

  `c`：压缩，数据在写入的时自动压缩，在读取时自动解压缩

  `d`：不转储：在进行备份时，告诉转储程序忽略此项

  `i`：不可变：不允许对该文件进行更改或删除（仅限 root 使用该属性）

  `j`：文件在写入时会先被记录在 `journal` 中，仅限 ext3 系统

  `s`：安全删除，删除时，用零覆盖文件中的所有数据

  `S`：同步更新：更改将立即写入磁盘

  `u`：不可删除：该文件不允许执行删除操作

  ```shell
  # option: R 递归，-V 显示过程
  chatter [options][+ - =] attributes [files]
  ```

* 查看文件的第二扩展文件系统属性

  `-E`：显示设备属性的当前值

  `-D`：显示属性的名称，属性的默认值，描述和用户是否可以修改属性值的标志

  `-R`：递归操作

  `-a`：列出所有文件，包括隐藏文件

  ```shell
  lsattr option file
  ```

  `-D`，`-E`，`-R` 这三个选项互斥，

* `lsater [options] files`

  显示扩展属性

  `-R`  递归处理

  `-a`  列出所有的文件，包含以点号开头的文件

  `-d`  如果显示目录的话，不显示其内容，仅显示目录本身

#### 文件查找

* which

  查找并显示文件绝对路径，会在环境变量 `PATH` 下查找文件

  ```shell
  which option parameter
  ```

* where

  查找二进制程序、代码等相关文件路径，where 从数据库记录上查找

  `-b`：只查找二进制文件

  `-f`：不显示文件名前的路径名称

  `-m`：只查找 man 文件

  `-s`：只查找原始代码文件

  `-u`：查找不包含指定类型的文件

  大写选项后跟目录在指定目录下查找

  ```shell
  whereis option parameter
  ```

* find

  在一个或多个目录中进行搜索符合特定条件的文件。

  `-name`：查找对象的文件名称

  `-path`：查找对象的路径名

  `-lname`：符号链接目标文件

  `-type t`： 查找类型为 t 的文件。包括 `f` 普通文件，`d` 目录，`l` 符号链接，`b` 块设备，`c` 字符设备，`p` 命名管道，`s` 套接字

  `-size N[bckw]`：查找大小为 N 的文件，单位可以是块（b），单字节字符（c），千字节（k），双字节（w）`+N` 即 `>N`，`-N` 即 `<N`

  `-empty`：查找大小为零的普通文件或目录

  `-user` ：查找属与给定用户的文件

  `-group name` ：查找属组为给定用户组的文件

  ```shell
  find [directories] [expression]
  ```

#### 文件比较

* 比较文件或目录差异

  对两个文件或两个目录进行逐行比较，在比较文本时，`diff` 可以提供详细的差异报告。如果没有差异，不出生成任何输出

  `-n`：使用 `rcsdiff` 命令的 RCS 版本控制格式

  `-c`：使用上下文输出格式，供 `patch` 命令使用

  `-D macro` ：C 预处理器格式，即 `#ifdef macro... #else ...#endif` 格式

  `-u`：一体化输出格式，它会对文件进行合并处理，`-` 表示删除，`+` 表示添加

  `-y`：并排格式，使用 `-W` 来调整输出的宽度

  `-e` ：创建一个 ed 脚本，如果运行该脚步的话，将会把 `fileA`  变为 `fileB`

  `-q`：不报告发生的那些变化，仅指出是否存在差异

  `-b`：不考虑空格

  `-B`：不考虑空白行

  `-i`：忽略大小写

  `-r` ：比较目录时，递归考察子目录

  ```shell
  # 比较两个文件或文件夹不同
  diff [options] file file
  # 比较三个文件或文件夹
  diff3 [options] file file1 file2
  # diff 的饼状图输出
  diffstat option file file
  ```

* 排序文件比较

  比较两个已排序的文件，并生成由三列组成的输出，各列之间以制表符分隔

  1. 所有出现在 `file1` 中但不在 `file2` 中的行
  2. 所有出现在 `file2` 中但不在 `file1` 中的行
  3. 所有同时出现在两个文件中的行

  `-1`  不显示第 1 列

  `-2`	不显示第 2 列

  `-3` 	不显示第 3 列

  `-23` 显示仅在第一个文件中出现的行

  `-13` 显示仅在第二个文件中出现的行

  `-12` 显示同时出现在第一个和第二个文件中的行

  ```shell
  comm [options] sort_file sort_file2
  ```

* 比较两个文件是否有差异

  比较两个文件。如果它们的内容是一样的，那么 cmp 不会输出任何内容；否则它会给出第一处差异所在的位置

  `-l`：长输出；逐字节输出所有差异

  `-s` ：静默输出，不打印任何东西，如果文件匹配返回 0，不匹配返回 1，失败返回其他代码

  ```shell
  cmp [options] parameter
  ```

* 比较哈希值

  ```shell
  md5sum file
  shasum file
  # SHA-256 算法
  shasum -a 256 file
  ```

#### 文本处理

* 正则匹配一个或多个文件

  给定一个或多个文件，输出其中与特定正则表达式模式匹配的所有行

  `-v`：只输出与正则表达式不匹配的行

  `-l`：仅输出包含匹配行的文件的名称，而不是输出匹配的行

  `-L` ：仅输出不包含匹配行的文件的名称

  `-c` ：仅输出匹配的行数

  `-n` ：在输出匹配结果的时候，每行的前面给出其原始行号

  `-b` ：在输出匹配结果的时候，每行的前面给出其文件中的偏移字节

  `-i`：匹配时不区分大小写

  `-w` ：只匹配完整的单纯

  `-x`：仅匹配完整的行，优先级高于 `-w` 选项

  `-A N`：输出匹配行，以及位于匹配行之后的 N 行

  `-B N` ：输出匹配行，以及位于匹配行之前的 N 行

  `-C N`：输出匹配行，以及位于匹配行前后的 N 行

  `--color = always`：突出显示匹配文件的颜色，以提高可读性

  `-r`：递归搜索目录及其子目录中的所有文件

  `-E`：使用扩展正则表达式

  `-F`：使用固定的字符串列表，而不是正则表达式。

  ```shell
  grep [options] pattern [files]
  ```

* 提取文件

  `cut`：命令从文件中提取文本列。列由字符偏移 `-c` 来定义的，字节偏移  `-b` 

  `-d C` ：使用字符 C 作为 -f 选项的字段之间的输入分隔符。默认使用制表符

  `--output-delimiter = C`：使用字符 C 作为 -f 选择的字段字节的输出分隔符。默认为制表符

  `-s`：排除不包含分隔符的行

  ```shell
  cut -(b|c|f) range [options] [files]
  # 提取第五个字符之后全部字符
  cut -c5- file
  # fields 指定了从 file 中要提取的字段，字段号从 1 开始
  cut -ddelimiter -ffields file
  cut -d: -f1 /etc/passwd
  # 如果字段是由制表符分隔的，可以使用 -f 选项
  ```

* 合并文件

  将多个文件视为垂直列，并将它们合并到标准输出上

  `-d delimiters` ：使用给定分隔符来分隔各列；默认使用制表符。可以提供一个单个字符 `-d:` 并自始至终使用该字符，或提供一个字符列表 `-dxyz` 将其依次用于各行

  `-s`：将输出的行和列进行转置

  ```shell
  paste [options] [files]
  paste files
  # 可以是一个或多个字符，粘贴分隔在一起的行，chars中的第一个字符用来分隔来自第一个文件和第二个文件的行，第二个字符用来分隔来自第二个文件和第三个文件的行，以此类推。如果文件的数量比 chars 中列出的字符要多，paste 会绕回重新分隔
  paste -d '+' file1 file2
  # 只从同一个文件中粘贴行，不管其他文件。如果只指定了单个文件，其效果是将该文件中所有的行合并到一起，彼此之间用制表符分隔（或是由 -d 选项指定的分隔符）
  paste -d'' -s names
  ```

* 将一组字符转换为另一组字符

  `-d`：从输入中删除包含在 `charset1` 中的字符

  `-s`：从输入中删除那些连续重置字符

  `-c`：只对 `charset1` 之外的字符进行操作

  `-t`：如果 `charset1` 长于 `charset2` ，则通过截断 `charset1` 使其长度相同。如果没有提供 `-t` 的话，则不断复制 `charset2 ` 的最后一个字符，直到 `charset2` 与 `charset1` 的长度相同为止

  ```shell
  tr [options] charset [charset]
  ```

  |        tr命令         |                       描述                        |
  | :-------------------: | :-----------------------------------------------: |
  |      tr 'X' 'x'       |                  将所有X替换成x                   |
  |     tr '()' '{}'      |                将所有 () 替换成 {}                |
  |  tr '[a-z]' '[A-Z]'   |          将所有的小写字母转换成大写字母           |
  | tr '[A-Z]' '[N-ZA-M]' | 将所有的大写字母A-M 替换成 N-Z，将 N~Z 转换成 A~M |
  |       tr ' '''        |  将所有的制表符（第一对引号中的字符）转换成空格   |
  |      tr -s ''''       |             将多个空格转换成单个空格              |
  |      tr -d '\14'      |           删除所有换页符（八进制为14）            |
  |     tr -d '[0-9]'     |                   删除所有数字                    |

* 将数据重定向到标准输入和文件

  `-a`：向文件中重定向时使用追加模式

  `-i`：忽略中断信号

  ```shell
  tee option parameter
  ```

* 流编辑器

  用来在管道或命令序列中编辑数据。它是 stream editor（流编辑器）的简称。并非交互式程序，默认情况下 `sed` 将输入的每一行都写入到标准输出中，不管其内容是否发生了变化。`-n` 指定不打印任何行，`p` 命令可以打印处符合指定范围或模式的所有行

  |              命令               |                             描述                             |
  | :-----------------------------: | :----------------------------------------------------------: |
  |           `sed '5d'`            |                          删除第5行                           |
  |       `sed '/[Tt]est/d'`        |                删除包含 Test 或 test 的所有行                |
  |     `sed -n '20,25p' text`      |               只打印 text 文件中第 20 ~ 25 行                |
  | `sed '1,10s/unix/UNIX/g' intro` |           将 intro 文件的前10行中的 unix 改成 UNIX           |
  |      `sed '/jan/s/-1/-5/'`      |           将包含 jan 的所有行中的第一个 -1 改成 -5           |
  |      `sed 's/...//' data`       |                  删除 data 中每行前3个字符                   |
  |      `sed 's/...$//' data`      |                 删除 data 中每行后 3 个字符                  |
  |       `sed -n '\|' text`        | 打印出 text 文件中所有的行，将不可打印字符显示为 `\nn`(八进制)，将制表符显示为 `\t` |

* 排序

  将文件进行排序，并将排序结果标准输出，既可以从特定文件，页可以从标准输入

  `-b`：忽略每行前面开始出的空格字符

  `-c`：检查文件是否已经按顺序排序

  `-d`：排序时，处理英文字母，数字和空格忽略其他的字符

  `-f`：排序时，将小写字母视为大写字母

  `-i`：排序时，除了 `040` ~ `176` 之间的 ASCII 字符外，忽略其他的字符

  `-m`：将几个排序好的文件进行合并

  `-M`：将前面三个字母依照月份的缩写排序

  `-u`：消除重复的行

  `-r`：逆序排序

  `-o`：指定输出文件

  `-n`：将行中第一个字段视为数字，`-k2n` 从第二个字段开始排序

  `-t`：后字符被视为分隔符，指定排序时所用的栏位分隔字符

* 去重

  `uniq` 用于报告或忽略文件中的重复行，一般与 sort 命令结合使用

  `-c`：在每列旁边显示该行重复出现的次数

  `-d`：仅显示重复出现的行

  `-u`：仅显示出一列的行列

  `-w`：后跟字符位置，指定要比较的字符

  ```shell
  uniq option paramter
  ```

  