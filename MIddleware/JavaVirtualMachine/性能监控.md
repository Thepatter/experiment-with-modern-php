### 虚拟机性能监控、故障处理工具

#### 工具

##### jps

```shell
jps [options] [hostid]
```

虚拟机进程状况工具

*options*

| 选项 |                           作用                           |
| :--: | :------------------------------------------------------: |
| `-q` |               只输出 LVMID，省略主类的名称               |
| `-m` |     输出虚拟机进程启动时传递给主类 main() 函数的参数     |
| `-l` | 输出主类的全名，如果进程执行的是 JAR 包，则输入 JAR 路径 |
| `-v` |             输出虚拟机进程启动时的 JVM 参数              |

JVM Process Status Tool 列出正在运行的虚拟机进程，并显示虚拟机执行主类（Main Class，main() 函数所在的类）名称以及这些进程的本地虚拟机唯一 ID（LVMID，Local Virtual Machine Identifier）

其他的 JDK 工具大多需要输入它查询到的 LVMID  来确定要监控的是哪一个虚拟机进程。对于本地虚拟机进程，LVMID 与操作系统的进程 ID 是一致的

jps 还可以根据 RMI 协议查询开启了 RMI 服务的远程虚拟机进程状态，参数 hostid 为 RMI 注册表中注册的主机名。

##### jstat

```shell
# 如果是本地虚拟机进程，VMID 与 LVMID 是一致的；如果是远程虚拟机进程，VMID 格式：[protocol:][//][lvmid][@hostname][:port]/servername]
# interval 代表查询间隔
# count 代表查询次数
jstat [option vmid [interval[sms] [count]]]
# 每 250 毫秒查询一次进程 2764 垃圾收集状况，一共查询 20 次
jstat -gc 2764 250 20
```

虚拟机统计信息监视工具

*options*

|        选项         |                             含义                             |
| :-----------------: | :----------------------------------------------------------: |
|      `-class`       |      监视类加载、卸载数量、总空间以及类装载所耗费的时间      |
|        `-gc`        | 监视 Java 堆状况，包括 Eden 区、2 个 Survivor 区、老年代、永久代等的容量，已用空间，垃圾收集时间合计等信息 |
|    `-gccapacity`    | 监视内容与 `-gc` 基本相同，但输出主要关注 Java 堆各个区域使用到的最大、最小空间 |
|      `-gcutil`      | 监视内容与 `-gc` 基本相同，但输出主要关注已使用空间占总空间的百分比 |
|     `-gccause`      | 与  `-gcutil` 功能一样，但是会额外输出导致上一次垃圾收集产生的原因 |
|      `-gcnew`       |                    监视新生代垃圾收集状况                    |
|  `-gcnewcapacity`   | 监视内容与 `-gcnew`基本相同，输出主要关注使用到的最大、最小空间 |
|      `-gcold`       |                    监视老年代垃圾收集状况                    |
|  `-gcoldcapacity`   | 监视内容与 `-gcold` 基本相同，输出主要关注使用到的最大、最小空间 |
|  `-gcpcrmcapacity`  |               输出永久代使用到的最大、最小空间               |
|     `-compiler`     |            输出即时编译器编译过的方法、耗时等信息            |
| `-printcompilation` |                   输出已经被即时编译的方法                   |

