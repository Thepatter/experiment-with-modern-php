### 幻读

**幻读指的是一个事务在前后两次查询同一个范围的时候，后一次查询看到了前一次查询没有看到的行**

* 在可重复读隔离级别下，普通的查询时快照读，是不会看到别的事务插入的数据的。因此，幻读在“当前读”下才会出现。幻读仅专指“新插入的行”

产生幻读的原因是，行锁只能锁住行，但是新插入记录这个动作，要更新的是记录之间的“间隙”。因此，为了解决幻读问题，`InnoDB` 只好加入新的锁，即间隙锁

数据行是可以加上锁的实体，数据行之间的间隙，也是可以加上锁的实体。跟间隙锁存在冲突关系的，是“往这个间隙中插入一个记录”这个操作。间隙锁之间都不存在冲突关系

间隙锁和行锁合称 `next-key lock`，每个 `next-key lock` 是前开后闭区间。

间隙锁的引入，可能会导致同样的语句锁住更大的范围，其实是影响了并发度。间隙锁是在可重复读隔离级别下才会生效的。如果把隔离级别设置为读提交，则没有间隙锁。但同时，要解决可能出现的数据和日志不一致问题，需要把 `binlog` 格式设置为 `row`。



