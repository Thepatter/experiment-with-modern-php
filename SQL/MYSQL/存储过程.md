### 存储过程

**为以后的使用而保存的一条或多条 MySQL 语句的集合**

#### 使用存储过程

MySQL 称存储过程的使用为调用，因此 MySQL 执行存储过程的语句为 `CALL`, `CALL` 接受存储过程的名字以及需要传递给它的任意参数。

```mysql
CALL productpricing(@pricelow,

				   @pricehigh,

				   @priceaverage);

```

#### 创建存储过程

```mysql
CREATE PROCEDURE productoricing()
BEGIN
	SELECT Avg(prod_price) as priceaverage FROM products;
END;
```

* 使用 `create procedure 存储过程名()`
* 如果存储过程接受参数，将在 `()` 中列举出来。
* `BEGIN` 和 `END` 语句用来限定存储过程体，过程体本身仅仅是一个简单的 `SELECT` 语句

#### 删除存储过程

* `DROP PROCEDURE IF EXISTS 存储过程名 `

#### 使用参数

* 一般，存储过程并不显示结果，而是把结果返回给指定的变量

* 每个参数必须具有指定的类型。关键字 `OUT` 指出相应的参数用来从存储过程传出一个值（返回给调用者）。

* MySQL 支持 IN （传递给存储过程），OUT（从存储过程传出），INOUT（对存储过程传入和传出）类型的参数，存储过程的代码位于 BEGIN 和 END 语句内

* 显示检索出来的变量 `select @out_value_name`

  ```mysql
  CREATE PROCEDURE productpricing(
  	OUT pl DECIMAL(8,2),
  	OUT ph DECIMAL(8,2),
  	OUT pa DECIMAL(8,2)
  )
  BEGIN
  	SELECT Min(prod_price) INTO pl FROM products;
  	SELECT Max(prod_price) INTO ph FROM products;
  	SELECT Avg(prod_price) INTO pa FROM products;
  END;
  ```

* 存储过程的参数允许的数据类型与表中使用的数据类型相同

* 记录集不是允许的类型，因此，不能通过一个参数返回多个行和列，所以上面例子要使用3个参数

  ```mysql
  CREATE PROCEDURE ordertotal(
  	IN onumber INT,
  	OUT ototal DECIMAL(8,2)
  )
  BEGIN
  	SELECT Sum(item_price * quantity)
  	FROM orderitems
  	WHERE order_num = onumber
  	INTO ototal;
  END;
  ```

* 调用 `CALL ordertotal(2005, @total)`, 显示 `SELECT @total`

 #### 查看存储过程

* 显示 create 语句 `show create procedure procedure_name`

* 显示存储过程列表 `show procedure status`

  

