## 使用

### 容器

#### 运行容器

```shell
docker run --name <container.nam> -i -t <image> /bin/bash
```

`-i` 标志保证容器中 STDIN 是开启的

`-t` 标志为要创建的容器分配一个伪 tty 终端

`-d` 会将容器放到后台运行

`-e`  环境变量

`-u` 设置用户

`-w` 指定工作目录

`—name` 指定容器名称

`-p` 端口映射

`-P` 对外公开在 `Dockerfile` 中通过 `EXPOSE` 指令公开的所有端口，随机绑定到宿主机的一个随机端口上。

```shell
# 随机选择32768~61000映射
-p 80
# 指定映射
-p 80:80
# 指定 ip 端口
-p 127.0.0.1:80:80
# 绑定到特定的网络接口的随机端口
-p 127.0.0.1::80
```

`—name` 为容器指定一个名称 `[a-zA-Z0-9_.-]`，容器的命名必须是唯一的。如果试图创建两个名称相同的容器，则命令将会失败

#### 重新启动已经停止的容器

```shell
docker start <container.name/id>
```

#### 附着到容器上

```shell
docker attach <container.name/id>
```

#### 获取日志

```shell
# 获取容器日志
docker logs <container.name/id>
# 获取日志的最后 10 行内容
docker logs -tail 10 <container.name/id>
# 跟踪某个容器的最新日志，而不必读取整个日志文件
docker logs -tail 0 -f <container.name/id>
# 为每条日志加上时间戳
docker logs -ft <container.name/id>
```

##### 日志驱动

通过启动 `Docker` 守护进程或者执行 `docker run` 命令时使用  `—log-driver` 选项来控制 `docker` 守护进程和容器所用的日志驱动：默认的 `json-file`、`syslog`(该选项将禁用 `docker logs` 命令，并且将所有容器的日志输出都重定向到 `Syslog`)、`none`(这个选项将会禁用所有容器中的日志，导致 docker logs 命令也被禁用)

```shell
docker run —log-driver="syslog" —name daemon_dwayne -d ubuntu /bin/sh
```

#### 查看容器内的进程

```shell
docker top <container.name/id>
```

#### 查看容器统计信息

```shell
docker stats <container.name/id>
```

#### 在容器内部运行进程

```shell
docker exec -d <container.name/id> touch /etc/new_config_file
```

`docker exec` 命令在容器内部额外启动新进程。可以在容器内运行的进程类型：后台任务和交互式任务。后台任务在容器内运行且没有交互需求，而交互式任务则保持在前台运行。对于需要在容器内部打开 `shell` 的任务，交互式任务是很实用。

#### 停止守护式容器

```shell
# docker stop 命令会向 docker 容器进程发送 SIGTERM 信号
docker stop <container.name/id>
# 快速停止某个容器
docker kill <container.name/id>
```

#### 自动重启容器

```shell
docker run --restart=always --name daemon_dave -d ubuntu /bin/bash
```

如果由于某种错误而导致容器停止运行，还可以通过 `—restart` 标志，让 `docker` 自动重新启动该容器。`—restart` 标志会检查容器的退出代码，并据此来决定是否要重启容器。默认的行为是 `docker` 不会重启容器。`—restart` 标志可以设置为：

*  `always` ，无论容器的退出代码是什么，`docker` 都会自动重启该容器。

* `on-failure`，这样，只有当容器的退出代码非 0 值的时候，才会自动重启。`on-failure` 还接受一个可选的重启次数

   `--restart=on-failure:5`

#### 获取容器信息

```shell
# 容器详细信息
docker inspect <container.name/id>
# 格式化信息
docker inspect --format='{{ .State.Running}}' <container.name/id>
# 查看端口
docker port <container.name/id>
```

#### 删除容器

```shell
# 删除容器
docker rm <container.name/id>
# 删除运行中容器
docker rm -f <container.name/id>
```

### 镜像

#### 基本使用

```shell
# 下载镜像
docker pull <image>:<tag>
# 列出镜像
docker images [<image.name>]
# 查找镜像
docker search <image>
# 删除镜像
docker image rm <image>:<tag>
```









