### 约定

* md5 校验值为小写字符
* AES 加密方法为 `AES-128-CBC`  `key` 为随机32 位小写字符串， `vi` 为加密方法对应向量长度随机字节串
* AES 采用 PKCS7Padding 填充模式加密
* RSA 加密 `padding = OPENSSL_PKCS1_PADDING`

### 客户端加密思想为：

* **原始数据采用 AES 对称加密**
* **AES 密钥采用 RSA 公钥加密**

#### 客户端加密流程

```flow
st=>start: 获取服务端 RSA 公钥（预先存储在客户端）
e=>end: 发送数据
io1=>inputoutput: 获取原始数据
op1=>operation: 将原始数据转成 json 字符串，并进行 base 64 编码，得到待进行 AES 加密数据
op2=>operation: 将待 AES 加密数据进行 md5 校验, 得到待 AES 加密数据的签名字符串
op3=>operation: 将待 AES 加密数据与签名字符串组成 json 字符串 键 data 值为 待 AES 加密数据，键 sign 值为 签名字符串，并进行 base64 编码
op4=>operation: 随机生成 32 位字符串作为 AES 密钥,生成随机 AES-128-CBC 16 位字节串 iv 初始向量
op5=>operation: 将待 AES 加密数据与 iv 初始向量进行 AES-128-CBC 方式加密后进行 base64 编码得到最终 data
op6=>operation: 将 AES 密钥进行 RSA 公钥加密后进行 base64 编码后，与 base64 编码后的 iv 进行 `·` 拼接得到 最终 secret 
op7=>operation: 最终传输数据为 键 data 值为 op5, 键 secret 值为 op6  
st->io1->op1->op2->op3->op4->op5->op6->op7->e
```




#### 服务端解密流程：

```flow
st=>start: 接收客户端传输数据
e=>end: 结束
io1=>inputoutput: 接收客户端传的 secret 和 data
op1=>operation: 分割 secret 将第一个字符串进行 base64 解码后进行 rsa 私钥解密，得到  AES 密钥。将第二部分进行 base64 解码后得到 iv 偏移向量
op2=>operation: 将 AES 密钥与 iv 偏移向量对 data 进行解密后进行 base64 解码后进行 json 解码，得到原生数据。
op3=>operation: 将原始数据 data 进行 md5 校验后与原始数据的 sign 进行签名校验
op4=>operation: op3 校验成功后进行 base64 解码后 json 解码，得到客户端袁术数据 
st->io1->op1->op2->op3->op4->e
```

#### 备注：

相对操作取反，任何一步操作失败及丢弃该次请求